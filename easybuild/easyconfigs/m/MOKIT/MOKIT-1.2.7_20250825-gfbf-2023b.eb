# Updated to latest tag
# Note: Python-3.12 and greater uses meson to build, which fails as the
# library is missing some fch_content_MOD_nb symbols
# Author: J. Sa√ümannshausen (Imperial College London/UK)

easyblock = 'Bundle'

name = 'MOKIT'
version = '1.2.7_20250825'
_commit = '7e1b4ee23186ab8a0d5ad6cf81c90832e101c669'

homepage = 'https://github.com/1234zou/MOKIT'
description = """
MOKIT offers various utilities and modules to transfer MOs among
various quantum chemistry software packages."""

citing = """
Currently we have not published the paper of MOKIT program.
If you use (any module or utility of) MOKIT in your work, please cite MOKIT as:
Jingxiang Zou, Molecular Orbital Kit (MOKIT), https://gitlab.com/jxzou/mokit
(accessed month day, year)

If you use MOKIT to perform calculations involving GVB, citing the following
two papers would be appreciated:
DOI: 10.1021/acs.jctc.8b00854; DOI: 10.1021/acs.jpca.0c05216.
"""

toolchain = {'name': 'gfbf', 'version': '2023b'}
toolchainopts = {'openmp': True}

dependencies = [
    ('Python', '3.11.5'),
    ('SciPy-bundle', '2023.11'),
]

_makefile = 'Makefile.gnu_openblas_conda'
maxparallel = 1

default_component_specs = {
    'source_urls': ['https://github.com/1234zou/MOKIT/archive'],
    'checksums': ['3a557b0014de2f8161eaaafafb9e45c31f35dfe36b2f6be7b2c90518c99c8bd3'],
    'sources': [{
        'download_filename': f'{_commit}.tar.gz',
        'filename': SOURCE_TAR_GZ,
    }],
}

components = [
    (name, version, {
        'easyblock': 'MakeCp',
        'start_dir': f'MOKIT-{_commit}/src',
        'prebuildopts': f'sed -i -e "s/^MKL_FLAGS.*/MKL_FLAGS = $LIBBLAS/" {_makefile} && ',
        'buildopts': f'all -f {_makefile}',
        'files_to_copy': ['../bin'],
    }),
    ('mokit', version, {
        'easyblock': 'PythonPackage',
        'start_dir': f'MOKIT-{_commit}',
        'options': {'modulename': 'mokit'},
    }),
]

sanity_check_commands = [
    'fch2inp | grep Example',
    'geom_opt | grep Example',
    "python -s -c 'from mokit.lib.gaussian import load_mol_from_fch'",
]

sanity_check_paths = {
    'files': ['bin/geom_opt', 'bin/fch2inp'],
    'dirs': ['lib/python%(pyshortver)s/site-packages/mokit'],
}

moduleclass = 'chem'
