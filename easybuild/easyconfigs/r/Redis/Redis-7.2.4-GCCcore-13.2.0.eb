easyblock = 'ConfigureMake'

name = 'Redis'
version = '7.2.4'

homepage = 'https://redis.io'
description = """Redis is an open source (BSD licensed), in-memory data structure store, used as
a database, cache, and message broker. Redis provides data structures such as
strings, hashes, lists, sets, sorted sets with range queries, bitmaps,
hyperloglogs, geospatial indexes, and streams. Redis has built-in replication,
Lua scripting, LRU eviction, transactions, and different levels of on-disk
persistence, and provides high availability via Redis Sentinel and automatic
partitioning with Redis Cluster."""

toolchain = {'name': 'GCCcore', 'version': '13.2.0'}

source_urls = ['https://download.redis.io/releases']
sources = [SOURCELOWER_TAR_GZ]
patches = [
    'Redis-fix-CVE-2025-46817.patch',
    'Redis-fix-CVE-2025-49844.patch',
]
checksums = [
    {'redis-7.2.4.tar.gz': '8d104c26a154b29fd67d6568b4f375212212ad41e0c2caa3d66480e78dbd3b59'},
    {'Redis-fix-CVE-2025-46817.patch': '8bb0ea4038bc05da9cd7ff48c3ea7f0ffec2946dcfcacdc8bfa5201c342c8b34'},
    {'Redis-fix-CVE-2025-49844.patch': '6d489a6e99c0e16bbc7434b096cd0fe22576701b3dfaaeffd1117f365bf16f2f'},
]

builddependencies = [
    ('binutils', '2.40'),
    ('pkgconf', '2.0.3'),
]

skipsteps = ['configure']

# tests must be run from a local filesystem
# runtest = 'test'

installopts = 'PREFIX="%(installdir)s"'

sanity_check_paths = {
    'files': ['bin/redis-cli', 'bin/redis-server'],
    'dirs': [],
}

sanity_check_commands = [('redis-server', '--version')]

moduleclass = 'data'
